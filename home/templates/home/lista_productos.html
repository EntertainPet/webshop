{% extends 'base.html' %}
{% load static %}

{% block title %}Cat√°logo - EntertainPet{% endblock %}

{% block global_sidebar %}
<!-- BOT√ìN PARA ABRIR LA BARRA DE FILTROS -->
<button id="openFilters" class="filter-button">‚öôÔ∏è Filtros</button>

<!-- BARRA LATERAL DE FILTROS -->
<div id="filterSidebar" class="filter-sidebar">

    <!-- CABECERA DEL SIDEBAR -->
    <div class="filter-header">
        <h2>Filtros</h2>
        <span id="closeFilters" class="close-btn">‚úñ</span>
    </div>

    <!-- FORMULARIO DE FILTROS -->
    <form method="GET" id="filterForm">

        <!-- BUSCAR -->
        <div class="filter-block">
            <label>Buscar:</label>
            <input type="text" name="q" placeholder="Buscar..." value="{{ search }}">
        </div>

        <!-- CATEGOR√çAS -->
        <div class="filter-block collapsible">
            <div class="filter-header-collapsible">
                <span>Categor√≠as</span>
                <svg class="arrow" width="16" height="16" viewBox="0 0 24 24">
                    <path d="M8 5l8 7-8 7" fill="none" stroke="#c19050" stroke-width="2"/>
                </svg>
            </div>
            <div class="filter-options">
                {% for c in categorias %}
                    <label class="filter-item">
                        <input type="checkbox" name="categoria" value="{{ c.id }}"
                              {% if c.id|stringformat:"s" in selected_categorias %}checked{% endif %}>
                        {{ c.nombre }}
                    </label>
                {% endfor %}
            </div>
        </div>

        <!-- MARCAS -->
        <div class="filter-block collapsible">
            <div class="filter-header-collapsible">
                <span>Marcas</span>
                <svg class="arrow" width="16" height="16" viewBox="0 0 24 24">
                    <path d="M8 5l8 7-8 7" fill="none" stroke="#c19050" stroke-width="2"/>
                </svg>
            </div>
            <div class="filter-options">
                {% for m in marcas %}
                    <label class="filter-item">
                        <input type="checkbox" name="marca" value="{{ m.id }}"
                              {% if m.0|stringformat:"s" in selected_marcas %}checked{% endif %}>
                        {{ m.nombre }}
                    </label>
                {% endfor %}
            </div>
        </div>

        <!-- MATERIALES -->
        <div class="filter-block collapsible">
            <div class="filter-header-collapsible">
                <span>Material</span>
                <svg class="arrow" width="16" height="16" viewBox="0 0 24 24">
                    <path d="M8 5l8 7-8 7" fill="none" stroke="#c19050" stroke-width="2"/>
                </svg>
            </div>
            <div class="filter-options">
                {% for mat in material %}
                    <label class="filter-item">
                        <input type="checkbox" name="material" value="{{ mat }}"
                              {% if mat in selected_materiales %}checked{% endif %}>
                        {{ mat }}
                    </label>
                {% endfor %}
            </div>
        </div>

        <!-- COLORES -->
        <div class="filter-block collapsible">
            <div class="filter-header-collapsible">
                <span>Color</span>
                <svg class="arrow" width="16" height="16" viewBox="0 0 24 24">
                    <path d="M8 5l8 7-8 7" fill="none" stroke="#c19050" stroke-width="2"/>
                </svg>
            </div>
            <div class="filter-options">
                {% for col in color %}
                    <label class="filter-item">
                        <input type="checkbox" name="color" value="{{ col }}"
                              {% if col in selected_colores %}checked{% endif %}>
                        {{ col }}
                    </label>
                {% endfor %}
            </div>
        </div>

        <!-- PRECIOS -->
        <div class="filter-block">
            <label><strong>Precio m√≠nimo:</strong></label>
            <input type="number" name="min" value="{{ request.GET.min }}">

            <label><strong>Precio m√°ximo:</strong></label>
            <input type="number" name="max" value="{{ request.GET.max }}">
        </div>

        <!-- BOT√ìN APLICAR -->
        <button type="submit" class="apply-btn">Aplicar filtros</button>

    </form>
    <form method="GET" id="clearFiltersForm">
        <button type="submit" class="clear-filters-btn">Eliminar filtros</button>
    </form>
</div>
{% endblock %}

{% block content %}
<div class="catalog-header">
    <h1>Cat√°logo</h1>
</div>

<div class="products-grid container">
    {% if productos %}
        {% for p in productos %}
        <div class="card">
            <div class="imagen-placeholder">
                {% if p.imagenes.first %}
                    <img src="{{ p.imagenes.first.imagen }}" alt="{{ p.nombre }}"
                         style="width:100%;height:100%;object-fit:cover;border-radius:6px">
                {% else %}
                    üñºÔ∏è
                {% endif %}
            </div>

            <h4>{{ p.nombre }}</h4>
            <div class="price">{{ p.precio }} ‚Ç¨</div>

            <a href="{% url 'home:producto_detalle' p.slug %}" class="detalle-link">Ver detalle</a>

            <form action="{% url 'home:carrito_add' p.pk %}" method="post">
                {% csrf_token %}
                <button type="submit" class="add-btn">A√±adir</button>
            </form>
        </div>
        {% endfor %}
    {% else %}
        <div style="background:#fff7e6;border:1px dashed #f0c36d;padding:12px;border-radius:8px;margin-bottom:12px">
            <strong>No se encontraron productos.</strong>
            <p style="margin:6px 0 0; color:#666">Intenta cambiar los filtros o la b√∫squeda.</p>
        </div>
    {% endif %}
</div>

<!-- PAGINACI√ìN -->
{% if is_paginated %}
    <div class="pagination">

        {% if page_obj.has_previous %}
            <a href="?{{ request.GET.urlencode }}&page={{ page_obj.previous_page_number }}">Anterior</a>
        {% endif %}

        <span>P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
            <a href="?{{ request.GET.urlencode }}&page={{ page_obj.next_page_number }}">Siguiente</a>
        {% endif %}

    </div>
{% endif %}

{% endblock %}
