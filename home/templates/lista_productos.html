{% extends 'base.html' %}
{% load static %}

{% block title %}Cat√°logo - EntertainPet{% endblock %}

{% block content %}
  <div class="catalog-header">
    <h1>Cat√°logo</h1>
  </div>

  <!-- ====== FORMULARIO DE B√öSQUEDA Y FILTRO ====== -->
  <div class="filter-container" style="margin-bottom:20px;">
    <form method="GET" class="filter-box">
        <input type="text" name="q" placeholder="Buscar..." value="{{ search }}">

        <select name="categoria">
            <option value="">Todas las categor√≠as</option>
            {% for c in categorias %}
                <option value="{{ c.id }}" {% if request.GET.categoria == c.id|stringformat:"s" %}selected{% endif %}>
                    {{ c.nombre }}
                </option>
            {% endfor %}
        </select>

        <select name="marca">
            <option value="">Todas las marcas</option>
            {% for m in marcas %}
                <option value="{{ m.id }}" {% if request.GET.marca == m.id|stringformat:"s" %}selected{% endif %}>
                    {{ m.nombre }}
                </option>
            {% endfor %}
        </select>

        <input type="number" name="min" placeholder="Precio m√≠nimo" value="{{ request.GET.min }}">
        <input type="number" name="max" placeholder="Precio m√°ximo" value="{{ request.GET.max }}">

        <button type="submit">Filtrar</button>
    </form>
  </div>
  <!-- ============================================ -->

  <div class="products-grid container">
    {% if productos %}
        {% for p in productos %}
        <div class="card">
            <div class="imagen-placeholder">
                {% if p.imagenes.first %}
                    <img src="{{ p.imagenes.first.imagen }}" alt="{{ p.nombre }}" style="width:100%;height:100%;object-fit:cover;border-radius:6px">
                {% else %}
                    üñºÔ∏è
                {% endif %}
            </div>

            <h4>{{ p.nombre }}</h4>
            <div class="price">{{ p.precio }} ‚Ç¨</div>

            <a href="{% url 'home:producto_detalle' p.slug %}" class="detalle-link">Ver detalle</a>

            <form action="{% url 'home:carrito_add' p.pk %}" method="post">
                {% csrf_token %}
                <button type="submit" class="add-btn">A√±adir</button>
            </form>
        </div>
        {% endfor %}
    {% else %}
        <div style="background:#fff7e6;border:1px dashed #f0c36d;padding:12px;border-radius:8px;margin-bottom:12px">
            <strong>No se encontraron productos.</strong>
            <p style="margin:6px 0 0; color:#666">Intenta cambiar los filtros o la b√∫squeda.</p>
        </div>
    {% endif %}
  </div>

  <!-- Paginaci√≥n -->
  {% if is_paginated %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.categoria %}categoria={{ request.GET.categoria }}&{% endif %}{% if request.GET.marca %}marca={{ request.GET.marca }}&{% endif %}page={{ page_obj.previous_page_number }}">Anterior</a>
      {% endif %}

      <span>P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.categoria %}categoria={{ request.GET.categoria }}&{% endif %}{% if request.GET.marca %}marca={{ request.GET.marca }}&{% endif %}page={{ page_obj.next_page_number }}">Siguiente</a>
      {% endif %}
    </div>
  {% endif %}

{% endblock %}
